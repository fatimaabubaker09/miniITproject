<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Profile</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script>
    function enableEditing() {
      const inputs = document.querySelectorAll("input");
      const selects = document.querySelectorAll("select");
      inputs.forEach(input => input.disabled = false);
      selects.forEach(select => select.disabled = false);
      document.getElementById("save-btn").style.display = "inline-block";
      document.getElementById("edit-btn").style.display = "none";
      document.getElementById("saved-msg").style.display = "none";
    }
  </script>
</head>
<body>
  <div class="navbar">
    <button>Profile</button>
    <button>Find Partner</button>
    <button>My Activity</button>
    <button onclick="location.href='{{ url_for('logout') }}'">Logout</button>
  </div>

  <div class="container">
    <h1>Welcome to your profile</h1>
    <h2>Welcome, {{ user.nickname or user.email }}!</h2>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        {% for message in messages %}
          <p style="color: green; font-weight: bold;">{{ message }}</p>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% if saved %}
      <p id="saved-msg" style="color: green; font-weight: bold;">Profile saved!</p>
    {% endif %}

    <form method="POST" action="{{ url_for('profile') }}">
      <h2><label for="nickname">Preferred nickname:</label></h2>
      <input type="text" id="nickname" name="nickname" value="{{ user.nickname }}" {% if saved %}disabled{% endif %}/>

      <h2><label for="age">Age:</label></h2>
      <input type="number" id="age" name="age" value="{{ session.get('age', '') }}" {% if saved %}disabled{% endif %}/>

      <h2><label for="faculty">Select your faculty:</label></h2>
      <select id="faculty" name="faculty" {% if saved %}disabled{% endif %} required>
          <option value="">-- Select Faculty --</option>
          <option value="FCI" {% if user.faculty == "FCI" %}selected{% endif %}>FCI - Faculty of Computing and Informatics</option>
          <option value="FCM" {% if user.faculty == "FCM" %}selected{% endif %}>FCM - Faculty of Creative Multimedia</option>
          <option value="FOM" {% if user.faculty == "FOM" %}selected{% endif %}>FOM - Faculty of Management</option>
          <option value="FCA" {% if user.faculty == "FCA" %}selected{% endif %}>FCA - Faculty of Cinematic Arts</option>
          <option value="FOL" {% if user.faculty == "FOL" %}selected{% endif %}>FOL - Faculty of Law</option>
          <option value="FOE" {% if user.faculty == "FOE" %}selected{% endif %}>FOE - Faculty of Engineering</option>
          <option value="FIT" {% if user.faculty == "FIT" %}selected{% endif %}>FIT - Faculty of Information Science and Technology</option>
          <option value="FOB" {% if user.faculty == "FOB" %}selected{% endif %}>FOB - Faculty of Business</option>
      </select>

      <h2><label for="level">Level of study:</label></h2>
      <select id="level" name="level" {% if saved %}disabled{% endif %} required>
          <option value="">-- Select Level --</option>
          <option value="Foundation" {% if user.level == "Foundation" %}selected{% endif %}>Foundation</option>
          <option value="Diploma" {% if user.level == "Diploma" %}selected{% endif %}>Diploma</option>
          <option value="Bachelors" {% if user.level == "Bachelors" %}selected{% endif %}>Bachelors Degree</option>
          <option value="Postgraduate" {% if user.level == "Postgraduate" %}selected{% endif %}>Postgraduate</option>
      </select>

      <h2><label for="gender">Gender:</label></h2>
      <select id="gender" name="gender" {% if saved %}disabled{% endif %} required>
          <option value="">-- Select Gender --</option>
          <option value="Female" {% if user.gender == "Female" %}selected{% endif %}>Female</option>
          <option value="Male" {% if user.gender == "Male" %}selected{% endif %}>Male</option>
          <option value="Prefer not to say" {% if user.gender == "Prefer not to say" %}selected{% endif %}>Prefer not to say</option>
      </select>

      <h2>Preferred Workout(s):</h2>
      {% set workouts = session.get('workouts', '').split(',') if session.get('workouts') else [] %}
      <input type="checkbox" name="workouts" value="Running" {% if "Running" in workouts %}checked{% endif %} {% if saved %}disabled{% endif %}> Running<br>
      <input type="checkbox" name="workouts" value="Swimming" {% if "Swimming" in workouts %}checked{% endif %} {% if saved %}disabled{% endif %}> Swimming<br>
      <input type="checkbox" name="workouts" value="Hiking" {% if "Hiking" in workouts %}checked{% endif %} {% if saved %}disabled{% endif %}> Hiking<br>
      <input type="checkbox" name="workouts" value="Gym" {% if "Gym" in workouts %}checked{% endif %} {% if saved %}disabled{% endif %}> Gym<br>
      <input type="checkbox" name="workouts" value="Walking" {% if "Walking" in workouts %}checked{% endif %} {% if saved %}disabled{% endif %}> Walking<br>
      <input type="checkbox" name="workouts" value="Pilates" {% if "Pilates" in workouts %}checked{% endif %} {% if saved %}disabled{% endif %}> Pilates<br>
      <input type="checkbox" name="workouts" value="Yoga" {% if "Yoga" in workouts %}checked{% endif %} {% if saved %}disabled{% endif %}> Yoga<br><br>

      <h2>Workout Frequency:</h2>
      {% set frequency = session.get('frequency', '') %}
      <input type="checkbox" name="frequency" value="any frequency" {% if "any frequency" == frequency %}checked{% endif %} {% if saved %}disabled{% endif %}> Any frequency<br>
      <input type="checkbox" name="frequency" value="daily" {% if "daily" == frequency %}checked{% endif %} {% if saved %}disabled{% endif %}> Daily<br>
      <input type="checkbox" name="frequency" value="weekly" {% if "weekly" == frequency %}checked{% endif %} {% if saved %}disabled{% endif %}> Weekly<br>
      <input type="checkbox" name="frequency" value="several times a week" {% if "several times a week" == frequency %}checked{% endif %} {% if saved %}disabled{% endif %}> Several times a week<br><br>

      <h2>Fitness Level:</h2>
      {% set fitness_level = session.get('fitness_level', '') %}
      <input type="checkbox" name="fitness_level" value="beginner" {% if "beginner" == fitness_level %}checked{% endif %} {% if saved %}disabled{% endif %}> Beginner<br>
      <input type="checkbox" name="fitness_level" value="intermediate" {% if "intermediate" == fitness_level %}checked{% endif %} {% if saved %}disabled{% endif %}> Intermediate<br>
      <input type="checkbox" name="fitness_level" value="advanced" {% if "advanced" == fitness_level %}checked{% endif %} {% if saved %}disabled{% endif %}> Advanced<br><br>

      <button id="save-btn" type="submit" name="save_profile" {% if saved %}style="display:none;"{% endif %}>Save Profile</button>
    </form>

    <form method="POST" action="{{ url_for('profile') }}">
      <input type="hidden" name="delete_account" value="true">
      <button type="submit" class="btn btn-danger" style="margin-top: 20px;" 
              onclick="return confirm('Are you sure you want to delete your account? This action cannot be undone.')">
          Delete Profile
      </button>
    </form>

    {% if saved %}
      <button id="edit-btn" onclick="enableEditing()">Edit</button>
    {% endif %}

    <br><br>
    <a href="{{ url_for('logout') }}">Logout</a>
  </div>
</body>
</html>

